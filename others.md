# CQRS架构

## 什么是 CQRS架构 ?

CQRS（Command Query Responsibility Segregation，命令查询职责分离）是一种软件架构模式，它将**修改操作（Command）与读取操作（Query）**明确分离开来，用不同的模型分别处理这两类操作

核心思想
- ` Command（命令）`：修改数据（增删改），不返回数据，只返回操作结果
- `Query（查询）`：读取数据，不做任何修改操作。

传统的 CRUD 模式中，增删改查操作通常在一个模型中完成（如 ORM 的 Repository）。而在 CQRS 中，这些职责被分开到`两个模型中`


## 为什么使用?

1. 性能优化
查询可以使用更复杂、专门为读优化的数据结构（如 Redis、ElasticSearch、甚至物化视图），提高读取性能。

2. 代码职责清晰
写逻辑只处理业务规则，不负责返回数据；读逻辑只关注数据查询和展示格式。

3. 易于扩展
读写模型可分别扩展或部署，比如将查询服务单独部署为只读副本，减轻主库压力。

4. 适合复杂领域逻辑
写模型（Command）可以结合 DDD（领域驱动设计）组织聚合、领域事件等，处理复杂的业务流程。


CQRS 架构图示意

``text

            +-------------+
            |   Client    |
            +-------------+
                /     \
               /       \
        +---------+   +----------+
        | Command |   |  Query   |
        | Handler |   | Handler  |
        +---------+   +----------+
              |           |
        +---------+   +----------+
        |  Write  |   |   Read   |
        | Storage |   | Storage  |
        +---------+   +----------+

```